# ドキュメント層 設計ガイド

## 基本思想

ドキュメントは「コード探索のための地図」である。コードが真実であり、ドキュメントはその真実への効率的なアクセスを提供する補助ツール。

## ドキュメント化の判断基準

以下のいずれかに該当する情報のみをドキュメントとして管理する:

1. **全体の地図としての役割** — コード全体を毎回読むことなく全体像を把握し、最適なコードを探索するために必要な情報
2. **頻繁に更新される情報** — プロジェクトの進行に伴い変化し続ける情報で、コードに散在させるよりも一元管理する方がメンテナンスしやすいもの

この基準に該当しない情報はドキュメントにしない。コード内コメントやREADMEで十分な情報を別途ドキュメント化すると、メンテナンスコストが増え乖離が生じる。

---

## 6つの標準ドキュメント

### 1. 機能一覧

単なるリストではなく、画面やAPIとの紐付けを持つ横断的なマップ。

**含める要素:**
- 機能名
- 説明
- 関連画面（画面一覧のIDで参照）
- 関連API（エンドポイント）
- ステータス（実装済み / 実装中 / 未実装）

**形式例:**

```markdown
| 機能ID | 機能名 | 説明 | 関連画面 | 関連API | ステータス |
|--------|--------|------|----------|---------|-----------|
| F001 | ユーザー登録 | メール/パスワードで新規登録 | S001, S002 | POST /api/users | 実装済み |
| F002 | ログイン | 認証とセッション管理 | S003 | POST /api/auth/login | 実装済み |
```

### 2. 画面一覧

画面間のナビゲーション構造を把握するためのマップ。

**含める要素:**
- 画面名
- URLパス
- 説明
- 画面遷移（どの画面からどこへ行けるか）

**形式例:**

```markdown
| 画面ID | 画面名 | URLパス | 説明 | 遷移元 | 遷移先 |
|--------|--------|--------|------|--------|--------|
| S001 | トップページ | / | ランディングページ | - | S002, S003 |
| S002 | 登録ページ | /register | ユーザー登録フォーム | S001 | S004 |
```

### 3. データベース設計（テーブル定義）

データ構造の全体像を把握するためのドキュメント。

**含める要素:**
- テーブル名
- カラム名・型・制約
- テーブル間のリレーション（ER図的な関係）

**形式例:**

```markdown
## users テーブル

| カラム名 | 型 | 制約 | 説明 |
|---------|-----|------|------|
| id | UUID | PK | ユーザーID |
| email | VARCHAR(255) | UNIQUE, NOT NULL | メールアドレス |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

### リレーション
- users 1:N posts（users.id → posts.user_id）
- users N:M roles（中間テーブル: user_roles）
```

### 4. アーキテクチャ設計

システム構成図のみに絞る。シンプルに全体を俯瞰するためのドキュメント。

**含める要素:**
- フロント・バック・DB・外部サービスの関係
- 通信プロトコルとデータフロー
- デプロイ構成

**形式例:**

```
[ブラウザ] --HTTPS--> [Next.js (Vercel)]
                          |
                      REST API
                          |
                     [FastAPI (Cloud Run)]
                          |
                     [PostgreSQL (Cloud SQL)]
                          |
                     [Redis (Memorystore)]
```

詳細な技術選定理由やパフォーマンス設計はここには書かない。

### 5. 環境構築手順書

ゼロから開発環境を立ち上げる手順のみに絞る。

**含める要素:**
- 前提条件（OS、ツールバージョン）
- インストール手順
- 環境変数の設定
- 起動コマンド
- 動作確認方法

コード探索だけでは非効率なタスクに対するガイドとして機能する。

### 6. E2Eテスト一覧

正常系のE2Eテストケースを定義する。

**含める要素:**

**テストカテゴリ一覧:**
- カテゴリ
- ID接頭辞
- 対象画面
- テストケース数

**各テストケース詳細:**
- テストID
- テスト名
- 画面/パス
- 前提条件
- 操作手順
- 期待結果

**テスト環境の前提条件:**
- 起動方法
- テスト用アカウント
- 使用ツール

---

## ドキュメントのメンテナンス

### 更新タイミング

- マイルストーン完了時
- 機能実装完了時
- DB変更を伴うマイグレーション実行後
- 画面追加・削除時

### 更新の原則

- コードが変わったらドキュメントも更新する。逆はない（ドキュメントが変わったからコードを変えるのではなく、コードの変更に追従してドキュメントを更新する）
- 更新が面倒ならドキュメントが多すぎる兆候。削減を検討する

### ファイル配置

```
docs/
├── features.md          # 機能一覧
├── screens.md           # 画面一覧
├── database.md          # データベース設計
├── architecture.md      # アーキテクチャ設計
├── setup.md             # 環境構築手順書
└── e2e-tests.md         # E2Eテスト一覧
```

配置パスはCLAUDE.mdのドキュメントセクションに記載する。
