# コンテキスト構造 診断チェックリスト

既存のコンテキスト構造を3原則に基づいてレビューするためのチェックリスト。

---

## 1. DRY原則の診断

同じ情報が複数の場所に記述されていないかを確認する。

### チェック項目

- [ ] **技術スタック情報の重複**: CLAUDE.mdとスキル定義の両方に同じ技術の詳細説明がないか
- [ ] **コーディング規約の重複**: 複数のエージェントやスキルに同じ規約が繰り返し書かれていないか
- [ ] **プロジェクト構造の重複**: ディレクトリ構成がCLAUDE.mdとドキュメントの両方に詳細に書かれていないか
- [ ] **判断基準の重複**: 同じ判断基準が複数のエージェントに書かれていないか（共通なら CLAUDE.md に引き上げるべき）
- [ ] **手順の重複**: 同じ手順が複数のスラッシュコマンドに書かれていないか（スキルに分離すべき）

### 違反が見つかった場合

情報を1つの層にのみ定義し、他からは参照パスで指し示す形に修正する。

---

## 2. 最小コンテキスト原則の診断

不必要にロードされるコンテキストがないかを確認する。

### チェック項目

- [ ] **CLAUDE.mdの肥大化**: 100行を超えていないか。特定の役割だけが必要な情報が混入していないか
- [ ] **エージェント定義の肥大化**: 1つのエージェントに役割外の情報が含まれていないか
- [ ] **スキルの粒度**: 1つのスキルに複数の独立した技術領域が混在していないか
- [ ] **スラッシュコマンドの肥大化**: オーケストレーション以上のロジックがコマンド内に書かれていないか
- [ ] **ドキュメントの過剰**: 6つの標準ドキュメント以外に不要なドキュメントが増えていないか
- [ ] **コードとの二重管理**: コード内コメントで十分な情報がドキュメントにも書かれていないか

### 違反が見つかった場合

情報を適切な層に移動し、元の場所には参照のみを残す。

---

## 3. 疎結合原則の診断

各要素が独立して変更可能かを確認する。

### チェック項目

- [ ] **スキルのエージェント依存**: スキルが特定のエージェントの存在を前提としていないか
- [ ] **エージェントのコマンド依存**: エージェントが特定のスラッシュコマンドからのみ呼ばれることを前提としていないか
- [ ] **スキルからドキュメントの直接参照**: スキルがドキュメントを直接参照していないか（エージェント経由であるべき）
- [ ] **コマンドの密結合**: スラッシュコマンドが他のスラッシュコマンドを呼び出していないか
- [ ] **循環参照**: エージェント間、スキル間に循環的な依存がないか

### 違反が見つかった場合

依存関係を解消し、各要素が独立して定義・変更可能な状態にする。

---

## 4. 層間の関係性の診断

定義された層間ルールが守られているかを確認する。

### チェック項目

- [ ] **全層 → CLAUDE.md参照**: 各エージェント・スキル・コマンドがCLAUDE.mdの前提に矛盾していないか
- [ ] **スラッシュコマンド → エージェント/スキル呼び出し**: コマンドが適切にエージェントやスキルを呼び出しているか
- [ ] **エージェント → スキル使用**: エージェントが使用するスキルを明示的に名指ししているか
- [ ] **エージェント → ドキュメント参照**: エージェントが参照するドキュメントを明示しているか
- [ ] **スキル → ドキュメント非参照**: スキルがドキュメントを直接参照していないか

---

## 5. 全体構造の診断

### チェック項目

- [ ] **CLAUDE.mdが存在し、5つの必須セクションを含むか**: 目的、設計原則、技術スタック、ディレクトリ構成、ドキュメントパス
- [ ] **エージェントが役割ごとに分離されているか**: 1エージェント = 1役割
- [ ] **スキルが技術領域ごとに分離されているか**: フロント、バック、テストなど
- [ ] **頻繁に行う定型タスクにスラッシュコマンドが定義されているか**
- [ ] **ドキュメントが最新のコードに追従しているか**
- [ ] **不要なドキュメントが放置されていないか**

---

## 診断結果の出力形式

診断後は以下の形式で結果をまとめる:

```markdown
## 診断結果サマリー

### 検出された問題

| # | 原則 | 問題 | 影響度 | 対象ファイル |
|---|------|------|--------|------------|
| 1 | DRY | [問題の説明] | 高/中/低 | [ファイルパス] |
| 2 | 最小コンテキスト | [問題の説明] | 高/中/低 | [ファイルパス] |

### 改善提案

[優先度の高い順に具体的な改善アクションを記述]

1. [改善アクション1]
2. [改善アクション2]
```
